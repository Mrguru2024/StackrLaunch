<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Load the Vite polyfill first -->
    <script src="/vite-polyfill.js"></script>
    
    <!-- Fix for "Cannot use import.meta outside module" issue -->
    <script>
      // Advanced runtime fix for import.meta error
      window.importMeta = {
        url: window.location.href,
        env: { MODE: "production", PROD: true, DEV: false }
      };
      
      // Safely define import.meta
      try {
        Object.defineProperty(window, "import", { 
          value: { meta: window.importMeta },
          writable: false,
          configurable: false
        });
      } catch (e) {
        console.warn("Could not define import.meta globally:", e);
      }
      
      // Catch and suppress specific errors
      window.addEventListener('error', function(e) {
        if (e && e.message && (
          e.message.includes('import.meta') || 
          e.message.includes('WebSocket') ||
          e.message.includes('Module') ||
          e.message.includes('Cannot read')
        )) {
          console.log('Prevented error:', e.message);
          e.preventDefault();
          e.stopPropagation();
          return true;
        }
      }, true);
      
      console.log("Runtime fixes for import.meta initialized");
    </script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VHVMZHY9MS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-VHVMZHY9MS');
    </script>
    
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5" />
    <!-- Remove CSP to eliminate potential WebSocket connection issues -->
    <!--
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; connect-src 'self' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com; script-src 'self' 'unsafe-inline' https://*.googletagmanager.com https://www.google-analytics.com https://ssl.google-analytics.com;" />
    -->
    
    <!-- Primary Meta Tags -->
    <title>Stackr | AI Financial Automation for Tradespeople, Side Hustlers & 9-5 Rebuilders</title>
    <meta name="description" content="Save $650/year & 5+ hours monthly with Stackr's AI financial automation built specifically for tradespeople, side hustlers, freelancers, and 9-5 rebuilders. Automate income, eliminate hidden fees, and grow your wealth." />
    <meta name="keywords" content="financial automation, money management app, side hustle finance, tradesperson budgeting, income automation, AI financial assistant, variable income management, freelancer finances, contractor money management, hidden fee detection, subscription tracker, financial growth, wealth building, budget automation, self-employed finances, financial planning, Atlanta fintech" />
    
    <!-- Indexing and Crawling Control -->
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://stackr.tech" />
    
    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://stackr.tech" />
    <meta property="og:title" content="Stackr | Smart Money Management for Tradespeople & Side Hustlers" />
    <meta property="og:description" content="AI-powered financial automation that saves you $650/year & 5+ hours monthly. Built for variable incomes, freelancers, and contractors. Join 131+ early adopters!" />
    <meta property="og:image" content="https://stackr.tech/og-image.jpg" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Stackr Financial" />
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://stackr.tech" />
    <meta name="twitter:title" content="Stackr | Financial Automation for Variable Incomes" />
    <meta name="twitter:description" content="Smart money management that actually works for tradespeople, side hustlers, and people with variable income. Save time & money automatically." />
    <meta name="twitter:image" content="https://stackr.tech/twitter-image.jpg" />
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’°</text></svg>" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- Security Headers -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- Structured Data - Organization -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Stackr Financial",
      "url": "https://stackr.tech",
      "logo": "https://stackr.tech/logo.png",
      "description": "AI-powered financial automation for tradespeople, side hustlers, and 9-5 rebuilders",
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer support",
        "email": "support@stackr.tech"
      },
      "sameAs": [
        "https://twitter.com/stackrfinancial",
        "https://www.linkedin.com/company/stackr-financial",
        "https://www.instagram.com/stackrfinancial"
      ]
    }
    </script>
    
    <!-- Structured Data - WebSite -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://stackr.tech",
      "name": "Stackr Financial Automation",
      "description": "AI-powered financial automation for people with variable incomes",
      "potentialAction": {
        "@type": "Action",
        "target": "https://stackr.tech/#waitlist",
        "name": "Join Waitlist"
      }
    }
    </script>
    
    <!-- Google Fonts with Display Swap for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" as="image" href="/src/assets/stackr-logo.svg" type="image/svg+xml" />
    <link rel="preload" as="image" href="/src/assets/stackr-logo.png" type="image/png" />
    
    <!-- Tally.so Form Widget -->
    <script async src="https://tally.so/widgets/embed.js"></script>
    
    <!-- Improved SEO with Meta Description targeting different personas -->
    <meta name="subject" content="Financial Automation Platform">
    <meta name="classification" content="Business, Finance, Technology">
    <meta name="language" content="EN">
    <meta name="author" content="Stackr Financial, Inc.">
    <meta name="designer" content="Stackr Team">
    <meta name="copyright" content="Â© 2025 Stackr Financial, Inc.">
    <meta name="owner" content="Stackr Financial, Inc.">
    <meta name="topic" content="Financial automation for tradespeople, side hustlers, and 9-5 rebuilders">
    <meta name="coverage" content="Worldwide">
    <meta name="distribution" content="Global">
  </head>
  <body>
    <div id="root"></div>
    <!-- Direct fix for import.meta errors -->
    <script>
      // Create a global shim for import.meta that will be used by any script that references it
      window.importMeta = {
        url: window.location.href,
        env: { 
          MODE: "production", 
          PROD: true, 
          DEV: false,
          BASE_URL: '/'
        },
        glob: function() { return {} }
      };
      
      // Define import.meta at the global level
      if (typeof import === 'undefined') {
        Object.defineProperty(window, "import", { 
          value: { 
            meta: window.importMeta 
          },
          writable: false,
          configurable: false
        });
      }
      
      // Block any attempt to reevaluate import.meta
      (function() {
        // Save original defineProperty 
        const originalDefineProperty = Object.defineProperty;
        
        // Override defineProperty to protect import.meta
        Object.defineProperty = function(obj, prop, descriptor) {
          if (obj === window && prop === 'import') {
            console.warn('Attempted to redefine import.meta, blocked');
            return obj;
          }
          return originalDefineProperty.call(this, obj, prop, descriptor);
        };
      })();
      
      console.log("Import.meta global shim installed");
    </script>
    
    <!-- Custom WebSocket client for server connection -->
    <script>
      // Initialize WebSocket connection to our custom endpoint
      function initializeWebSocket() {
        try {
          // Use the correct protocol based on the page protocol
          const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
          // Connect to our custom WebSocket endpoint
          const wsUrl = `${protocol}//${window.location.host}/ws`;
          console.log('Connecting to WebSocket at:', wsUrl);
          
          const socket = new WebSocket(wsUrl);
          
          socket.onopen = function() {
            console.log('WebSocket connection established');
            socket.send('Hello from Stackr client');
          };
          
          socket.onmessage = function(event) {
            console.log('Message from server:', event.data);
          };
          
          socket.onerror = function(error) {
            console.error('WebSocket error:', error);
          };
          
          socket.onclose = function() {
            console.log('WebSocket connection closed');
            // Optional: reconnect after a delay
            setTimeout(initializeWebSocket, 5000);
          };
          
          // Store socket reference globally
          window.__stackrSocket = socket;
        } catch (e) {
          console.error('Error initializing WebSocket:', e);
        }
      }
      
      // Initialize when page is loaded
      if (document.readyState === 'complete') {
        initializeWebSocket();
      } else {
        window.addEventListener('load', initializeWebSocket);
      }
    </script>
    
    <script type="module" src="/src/main.tsx"></script>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>
